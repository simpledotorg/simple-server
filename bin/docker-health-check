#!/usr/bin/env bash

# Passenger is not allowing to check ping endpoint with http
# When callling the ping endpoint, Passenger is returning 301 (https redirect)
# So we are using a script to check if Passenger is responding with 301

# Health check timeout
max_time=$1
if [ -z "$max_time" ]; then
  max_time=1 # Set default timeout to 1 second
fi

http_code=$(curl -s -o /dev/null -w "%{http_code}" --max-time $max_time localhost:80/api/v3/ping)

if [ $http_code -eq 301 ]; then
  exit 0
else
  exit 1
fi
