<% content_for :title do %>
 Reports
<% end %>

<% if current_admin.accessible_facilities(:view_reports).any? %>  
<%= form_tag regions_search_url(format: :json), id: "search-form", method: :get do %>
  <div class="mo-search">
    <div class="mo-search-inner">
    <%= render "shared/region_search" %>
    </div>
  </div>
<% end %>
<% end %>

<h1 class="page-header">
  Reports
</h1>
<div class="container">
  <div class="row">
    <div class="col-sm-5 col-lg-7">

      <div id="facility-access">
        <% @accessible_regions.each do |org, children| %>
          <div class="card organization show">
            <div class="access-tree__section-header">
              <% if current_admin.feature_enabled?(:organization_reports) %>
                <h3><%= link_to(org.name, reports_region_path(org.source.slug, report_scope: org.region_type)) %></h3>
              <% else %>
                <h3><%= org.name %></h3>
              <% end %>
            </div>

            <%= render Reports::RegionTreeComponent.new(parent: org, children: children) %>
          </div>
        <% end %>
      </div>

      <script>
        const async = false;
        new AdminAccess("facility-access").initialize(async);
      </script>

    </div>
  </div>
</div>
