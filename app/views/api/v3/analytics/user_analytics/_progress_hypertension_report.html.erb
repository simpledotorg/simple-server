<div id="progress-hypertension-report" style="display: none;">
  <div class="mb-8px pt-16px pb-16px bgc-white bs-card">
    <a
      class="d-block w-24px h-24px mb-24px pl-16px"
      href="#"
      onclick="closeWindow('progress-hypertension-report', 'progress-start'); return false;"
    >
      <div class="d-inline-block">
        <%= inline_file("chevron-left.svg") %>
      </div>
    </a>
    <div class="pr-16px pl-16px">
      <h1 class="m-0px mb-8px fw-bold fs-24px">
        <%= t("progress_tab.hypertension_report_title") %> report
      </h1>
      <p class="m-0px p-0px ta-left fw-normal fs-16px c-grey-dark">
        <%= t("progress_tab.last_updated_at", date: DateTime.parse(@user_analytics.last_updated_at).to_date.strftime("%d-%b-%y at %I:%M %P")) %>
      </p>
    </div>
  </div>
  <%= render(Reports::ProgressAssignedPatientsComponent.new(@service, @period)) %>
  <%= render(Reports::ProgressTotalRegistrationsComponent.new(@service, @period)) %>
  <%= render(Reports::ProgressMonthlyFollowUpsComponent.new(@service, @period)) %>
  <div class="mt-48px mb-16px pr-16px pl-16px">
    <h3 class="m-0px p-0px ta-left fw-bold fs-20px c-grey-dark">
      <%= t("progress_tab.diagnosis_report.patient_treatment_outcomes.section_title") %>
    </h3>
  </div>
  <%= render(Reports::ProgressControlComponentV1.new(@service, @current_user)) %>
  <%= render(Reports::ProgressUncontrolledComponent.new(@service)) %>
  <%= render(Reports::ProgressMissedVisitsComponent.new(@service)) %>
  <% if @drug_stocks_query %>
    <div class="mt-48px mb-16px pr-16px pl-16px">
      <h3 class="m-0px p-0px ta-left fw-bold fs-20px c-grey-dark">
        <%= t("progress_tab.diagnosis_report.drug_stock_report.section_title") %>
      </h3>
    </div>
    <% @drugs_by_category.each do |category, drugs| %>
      <% patient_days = @drug_stocks_query.patient_days_by_facility_id.dig(@current_facility.id, category, :patient_days) || 0 %>
      <div class="mb-8px p-16px bgc-white bs-card">
        <h3 class="m-0px mb-2px p-0px ta-left fw-medium fs-20px c-black">
          <%= protocol_drug_labels[category][:full] %>
        </h3>
        <p class="m-0px mb-16px p-0px ta-left fw-regular fs-16px lh-150 <%= patient_days_css_class(patient_days, prefix: "c") %>">
          <%= patient_days %> days of drug stock
        </p>
        <% drugs.each_with_index do |drug, index| %>
          <% drug_stock = @drug_stocks_query.drugs_in_stock_by_facility_id.dig([@current_facility.id, drug.rxnorm_code]) %>
          <div class="d-flex ai-center jc-space-between">
            <p class="m-0px p-0px ta-left fw-regular fs-16px c-black">
              <%= drug.name %> <%= drug.dosage %>
            </p>
            <p class="m-0px p-0px ta-left fw-regular fs-16px c-black">
              <% if drug_stock.present? %>
                <%= drug_stock %> tablets
              <% else %>
                &#8212;
              <% end %>
            </p>
          </div>
          <% unless drugs.length == index + 1 %>
            <div class="h-1px mt-8px mb-8px bgc-grey-light"></div>
          <% end %>
        <% end %>
      </div>
    <% end %> 
  <% end %>
  <div class="mt-48px mb-16px pr-16px pl-16px">
    <h3 class="m-0px p-0px ta-left fw-bold fs-20px c-grey-dark">
      <%= t("progress_tab.diagnosis_report.cohort_report.section_title") %>
    </h3>
  </div>
  <div class="mb-8px p-16px bgc-white bs-card">
    <h2 class="m-0px mb-8px p-0px ta-left fw-medium fs-18px c-black">
      <%= t("progress_tab.diagnosis_report.cohort_report.card_title") %>
    </h2>
    <p class="m-0px mb-12px p-0px ta-left fw-normal fs-16px lh-150 c-grey-dark">
      <%= t("progress_tab.diagnosis_report.cohort_report.card_subtitle") %>
    </p>
    <div class="mb-32px">
      <div class="d-flex ai-center jc-center mb-8px">
        <div class="w-16px h-16px mr-8px br-4px bgc-green-new"></div>
        <p class="f-1 m-0px p-0px ta-left fw-regular fs-14px c-black">
          <%= t("progress_tab.diagnosis_report.diagnosis_thresholds.hypertension_controlled_short") %>
        </p>
      </div>
      <div class="d-flex ai-center jc-center mb-8px">
        <div class="w-16px h-16px mr-8px br-4px bgc-yellow-new"></div>
        <p class="f-1 m-0px p-0px ta-left fw-regular fs-14px c-black">
          <%= t("progress_tab.diagnosis_report.diagnosis_thresholds.hypertension_uncontrolled_short") %>
        </p>
      </div>
      <div class="d-flex ai-center jc-center mb-8px">
        <div class="w-16px h-16px mr-8px br-4px bgc-orange-new"></div>
        <p class="f-1 m-0px p-0px ta-left fw-regular fs-14px c-black">
          <%= t("progress_tab.diagnosis_report.diagnosis_thresholds.hypertension_visited_but_no_bp_taken_short") %>
        </p>
      </div>
      <div class="d-flex ai-center jc-center">
        <div class="w-16px h-16px mr-8px br-4px bgc-red-new"></div>
        <p class="f-1 m-0px p-0px ta-left fw-regular fs-14px c-black">
          <%= t("progress_tab.diagnosis_report.diagnosis_thresholds.missed_visits_short") %>
        </p>
      </div>
    </div>
    <% @user_analytics.statistics.dig(:cohorts).each_with_index do |cohort, index| %>
      <div class="<% if @user_analytics.statistics.dig(:cohorts).length - 1 > index %>mb-24px<% end %>">
        <p class="m-0px mb-2px p-0px ta-left fw-regular fs-16px c-black">
          <%= t("progress_tab.diagnosis_report.cohort_report.cohort_title", period: cohort[:results_in]) %>
        </p>
        <p class="m-0px mb-8px p-0px ta-left fw-reguar fs-16px c-grey-dark">
          <%= t("progress_tab.diagnosis_report.cohort_report.cohort_subtitle", number_of_patients: cohort[:registered] || 0, patient_or_patients: "patient".pluralize(cohort[:registered] || 0), registration_period: cohort[:patients_registered]) %>
        </p>
        <%= render partial: "api/v3/analytics/user_analytics/data_stacked_bar_graph", locals: { data: cohort } %>
      </div>
    <% end %>
  </div>
</div>